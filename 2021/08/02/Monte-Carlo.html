<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Calculating integrals using Monte Carlo methods | An Introduction to Computational Physics</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Calculating integrals using Monte Carlo methods" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Resources for the second year course “Theory, computation and experiment” (KD5081) at Northumbria University, UK." />
<meta property="og:description" content="Resources for the second year course “Theory, computation and experiment” (KD5081) at Northumbria University, UK." />
<link rel="canonical" href="https://nu-cem.github.io/CompPhys/2021/08/02/Monte-Carlo.html" />
<meta property="og:url" content="https://nu-cem.github.io/CompPhys/2021/08/02/Monte-Carlo.html" />
<meta property="og:site_name" content="An Introduction to Computational Physics" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-02T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Calculating integrals using Monte Carlo methods" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-08-02T00:00:00-05:00","datePublished":"2021-08-02T00:00:00-05:00","description":"Resources for the second year course “Theory, computation and experiment” (KD5081) at Northumbria University, UK.","headline":"Calculating integrals using Monte Carlo methods","mainEntityOfPage":{"@type":"WebPage","@id":"https://nu-cem.github.io/CompPhys/2021/08/02/Monte-Carlo.html"},"url":"https://nu-cem.github.io/CompPhys/2021/08/02/Monte-Carlo.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/CompPhys/assets/css/style.css"><link rel="shortcut icon" type="image/x-icon" href="/CompPhys/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/CompPhys/">An Introduction to Computational Physics</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/CompPhys/about/">About</a><a class="page-link" href="/CompPhys/links/">Links</a><a class="page-link" href="/CompPhys/search/">Search</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"] ],
       processEscapes: true
     }
   });
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>


<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Calculating integrals using Monte Carlo methods</h1><p class="post-meta post-meta-title">
    </p>

    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/NU-CEM/CompPhys/tree/master/_notebooks/2021-08-02-Monte-Carlo.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/CompPhys/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/NU-CEM/CompPhys/master?filepath=_notebooks%2F2021-08-02-Monte-Carlo.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/CompPhys/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/NU-CEM/CompPhys/blob/master/_notebooks/2021-08-02-Monte-Carlo.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/CompPhys/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"] ],
       processEscapes: true
     }
   });
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>



<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-08-02-Monte-Carlo.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />
<p>Questions:</p>
<ul>
<li>How do I generate random numbers?</li>
<li>How do I integrate using Monte Carlo methods?</li>
<li>When might Monte Carlo integration be useful?</li>
</ul>
<p>Objectives:</p>
<ul>
<li>Use the <code>random</code> module to generate random numbers</li>
<li>Use Monte Carlo methods to calculate the area of a circle</li>
</ul>
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="There-are-many-different-numerical-methods-for-calculating-integrals">There are many different numerical methods for calculating integrals<a class="anchor-link" href="#There-are-many-different-numerical-methods-for-calculating-integrals"> </a></h3><p>In the previous section we studied the simplest methods for calculating integrals: the rectangular-slice method . For increased accuracy and computational efficiency, there are extensions to this approach - for example, the trapezoid method (where each slice is a trapezoid rather than rectangle) or Simpson's rule (where a quadratic curve is fitted to each slice). For certain classes of functions we can increase the performance further using more specialised approaches such as Gaussian Quadrature.</p>
<p>One particularly flexible and general purpose approach for calculating integrals is to use Monte Carlo integration. This approach is useful when the integrand is "pathological" (wildly varying) or noisy, or when the integration is performed over several variables.</p>
<h3 id="Monte-Carlo-methods-calculate-the-answers-to-exact-calculations-by-doing-random-calculations">Monte Carlo methods calculate the answers to exact calculations by doing random calculations<a class="anchor-link" href="#Monte-Carlo-methods-calculate-the-answers-to-exact-calculations-by-doing-random-calculations"> </a></h3><p>Monte Carlo methods are a broad class of algorithms that rely on random sampling to obtain numerical results. The underlying concept is to use randomness to solve problems that might be deterministic in principle. "Monte Carlo" is a reference to a well-known casino town, since the element of chance is core to the modelling approach, similar to various casino games.</p>
<p>Monte Carlo methods are applied across a wide variety of domains, most commonly mathematics, physics and finance. In physics, Monte Carlo methods are used to design particle detectors, model galaxy evolution and solve the many-body problem for quantum systems, amongst many other applications. In this lesson we will introduce one of the main uses of Monte Carlo: for integration.</p>
<h3 id="The-Monte-Carlo-&quot;area-method&quot;-estimates-integrals-by-generating-a-uniform-sample-of-points-and-counting-how-many-fall-into-a-planar-region">The Monte Carlo "area method" estimates integrals by generating a uniform sample of points and counting how many fall into a planar region<a class="anchor-link" href="#The-Monte-Carlo-&quot;area-method&quot;-estimates-integrals-by-generating-a-uniform-sample-of-points-and-counting-how-many-fall-into-a-planar-region"> </a></h3><p>Consider the shaded area as shown below. This is the integral $I$ which we wish to calculate.</p>
<p><figure>
  
    <img class="docimage" src="/CompPhys/images/copied_from_nb/../images/mc_area.png" alt="" style="max-width: 400px" />
    
    
</figure>
</p>
<p>If we choose a point uniformly at random in the rectange (dashed red line) that bounds the shaded area, the probability $p$ that the point falls in the shaded area is</p>
<p>
$$p = \frac{I}{A}$$
</p>
<p>where $A$ is the area of the bounding rectangle. This means that the integral $I$ can be calculated if we know the area of the bounding rectangle and the probability $p$:</p>
<p>
$$I = Ap$$
</p>
<p>To calculate $p$ we can randomly generate $N$ points in the bounding area and keep count as to how many lie in the shaded area. If $k$ lie in the shaded area then the fraction of points $\frac{k}{N}$ should be equal to the probability $p$.</p>
<p>
$$I = \frac{Ak}{N}$$
</p>
<p>We can extend this approach to higher dimensions to consider integrands lying within a bounding volume, or higher dimensional space (which is considered in the <a href="https://nu-cem.github.io/CompPhys/2021/08/02/Random_extension">extension exercise</a> for this lesson).</p>
<h3 id="We-can-use-the-Monte-Carlo-area-method-to-estimate-pi">We can use the Monte Carlo area method to estimate pi<a class="anchor-link" href="#We-can-use-the-Monte-Carlo-area-method-to-estimate-pi"> </a></h3><p>We'll now use this approach to give us an estimate for the value of pi by considering the area under a quarter-circle.</p>
<figure>
<figure>
  
    <img class="docimage" src="https://raw.githubusercontent.com/coderefinery/jupyter/main/example/darts.svg" alt="" style="max-width: 300px" />
    
    
</figure>

</figure><p>The relevant equations are:</p>
<p>square area: $A_s = (2 r)^2$<br />
circle area: $A_c = \pi r^2$</p>
<p>The ratio of the areas can be related to $\pi$ through the following expressions:</p>
<p>$\frac{A_c}{A_s} = \frac{\pi r^2}{4 r^2} = \frac{\pi}{4}$<br />
$\pi = 4\frac{A_c}{A_s}$</p>
<p>To approximate the ratio $\frac{A_c}{A_s}$ we will generate a (uniform) pseudo-random number between 0 and 1 for our x-coordinates, and a (uniform) pseudo-random number between 0 and 1 for our y-coordinates. We will then check if our random point lies in or out of the circle. The probability $P_i$ that our point lies in the circle is related to the area ratio and so value of pi:</p>
<p>$P_i = \frac{A_c}{A_s} = \frac{\pi}{4}$</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-Monte-Carlo-area-method-can-be-translated-into-Python-code">The Monte Carlo area method can be translated into Python code<a class="anchor-link" href="#The-Monte-Carlo-area-method-can-be-translated-into-Python-code"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># in this function we generate random numbers and count how many lie within the circle</span>
<span class="k">def</span> <span class="nf">estimate_pi</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
    
    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span><span class="p">):</span>
        <span class="c1"># random.random returns a random number drawn from a uniform distribution from 0 to 1</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="c1"># we test if the point is within the circle (using the equation for a circle, X^2+y^2=r^2)</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="n">probability</span> <span class="o">=</span> <span class="n">hits</span> <span class="o">/</span> <span class="n">num_points</span>
    <span class="k">return</span> <span class="n">probability</span><span class="o">*</span><span class="mi">4</span>
        
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">estimate_pi</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>3.104</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">estimate_pi</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>3.176</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This method usually improves with the number of points, however there can be some variation due to the randomness of the numbers used. If you would like others to reproduce your exact results, you can seed the (pseudo-)random number generator:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">estimate_pi</span><span class="p">(</span><span class="mi">1000</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>error is 0.029592653589793017
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">estimate_pi</span><span class="p">(</span><span class="mi">2000</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>error is -0.004407346410206792
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Monte-Carlo-integration-is-computationally-efficient-for-particular-types-of-integrand">Monte Carlo integration is computationally efficient for particular types of integrand<a class="anchor-link" href="#Monte-Carlo-integration-is-computationally-efficient-for-particular-types-of-integrand"> </a></h3><p>The error when using Monte Carlo integration is proportional to $N^{-\frac{1}{2}}$, which is larger than the rectangular slice approach with error order $h \propto N^{-1}$ (where $N$ in this case is the number of integration slices). However Monte Carlo methods are more flexible and can be used where other methods break-down: for example, they are particularly useful for integrating functions where the integrand varies very quickly, and/or where the integral is over many variables. In many cases, for "well behaved" functions, an approach based on Riemann summation will give more accurate and computationally efficient results.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />
<p>Keypoints:</p>
<ul>
<li>There are many different numerical methods for calculating integrals</li>
<li>Monte Carlo methods calculate the answers to exact calculations by doing random calculations</li>
<li>The Monte Carlo "area method" estimates integrals by generating a uniform sample of points and counting how many fall into a planar region</li>
<li>We can use the Monte Carlo area method to estimate pi</li>
<li>The Monte Carlo area method can be translated into Python code</li>
<li>Monte Carlo integration is computationally efficient for particular types of integrand</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />
<p>Do <a href="https://nu-cem.github.io/CompPhys/2021/08/02/Monte-Carlo-Qs.html">the quick-test</a>.</p>
<p>Back to <a href="https://nu-cem.github.io/CompPhys/2021/08/02/Integrals.html">Calculating Integrals</a>.</p>
<hr />

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/CompPhys/2021/08/02/Monte-Carlo.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/CompPhys/"></data>

</footer>
</body>

</html>
